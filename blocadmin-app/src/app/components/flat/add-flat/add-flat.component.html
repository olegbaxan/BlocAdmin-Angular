<div class="container" *ngIf="tokenStorageService.isLoggedIn; else loggedOut">
  <div class="row">
    <div class="col-12" *ngIf="flat"
         style="border: 2px solid; border-color: rgb(0, 38, 255); font-size: 20px;height: auto">

      <div class="submit-form">
        <div *ngIf="!submitted">
          <h2 class="justify-content-center m-3">Add a new Flat</h2>

          <div class="form-group form-group-sm col-sm-8 m-5">
            <div class="row">
              <label for="building" class="col-sm-3 col-form-label">Building</label>
              <div class="col-sm-9">
                <ng-select class="custom" id="building"
                           (change)="select()"
                           [searchable]="true"
                           [multiple]="false"
                           [(ngModel)]=selectedBuilding>
                  <ng-option *ngFor="let building of buildings"
                             [value]="building">{{building?.address?.city}} {{building?.address?.raion}} {{building?.address?.street}} {{building?.address?.houseNumber}}
                    <span *ngIf="building?.address?.entranceNo">/{{building?.address?.entranceNo}}</span></ng-option>
                </ng-select>
              </div>
            </div>
          </div>
          <button type="cancel" class="btn btn-danger btn-lg m-5 col-sm-2" routerLink="/buildings/add">Add New
            Building
          </button>
          <div class="form-group form-group-sm col-sm-8 m-5">
            <div class="row">
              <label for="person" class="col-sm-3 col-form-label">Person</label>
              <div class="col-sm-9">
                <ng-select class="custom" id="person"
                           [searchable]="true"
                           [multiple]="true"
                           [(ngModel)]=selectedPerson>
                  <ng-option *ngFor="let person of persons"
                             [value]="person">{{person.name}} {{person.surname}}</ng-option>
                </ng-select>
              </div>
            </div>
          </div>
          <button type="cancel" class="btn btn-danger btn-lg m-5 col-sm-2" routerLink="/person/add">Add New Person
          </button>
          <div class="form-group form-group-sm col-sm-8 m-5">
            <div class="row">
              <label for="flatnumber" class="col-sm-3 col-form-label">Flat number</label>
              <div class="col-sm-9">
                <input type="number" min="0" [max]="selectedBuilding?.flats" class="form-control" id="flatnumber" placeholder="Enter flat number"
                       [(ngModel)]="flat.flatNumber" name="flatNumber" required="true" (change)="chooseFlatNumber($event)">
              </div>
            </div>
          </div>
          <div class=" form-group form-group-sm col-sm-6 m-5 " *ngIf="flatError">
            <div class="row">
              <label class="col-sm-3 col-form-label"></label>
              <div class="alert-danger  col-sm-9">
                Flat Number is bigger then exists
              </div>
            </div>
          </div>
          <div class="form-group form-group-sm col-sm-8 m-5">
            <div class="row">
              <label for="floor" class="col-sm-3 col-form-label">Floor</label>
              <div class="col-sm-9">
                <input type="number" min="0" [max]="selectedBuilding?.floors" class="form-control" id="floor" placeholder="Enter floor number"
                       [(ngModel)]="flat.floor" name="floor" required="true" (change)="chooseFloorNumber($event)">
              </div>
            </div>
          </div>

          <div class=" form-group form-group-sm col-sm-6 m-5 " *ngIf="floorError">
            <div class="row">
              <label class="col-sm-3 col-form-label"></label>
              <div class="alert-danger  col-sm-9">
                Floor Number is bigger then exists
              </div>
            </div>
          </div>
          <div class="form-group form-group-sm col-sm-8 m-5">
            <div class="row">
              <label for="wallet" class="col-sm-3 col-form-label">Wallet</label>
              <div class="col-sm-9">
                <input type="double" min="1" class="form-control" id="wallet"
                       [(ngModel)]="flat.wallet" name="wallet" readonly="true">
              </div>
            </div>
          </div>
          <div class="form-group form-group-sm col-sm-8 m-5">
            <div class="row">
              <label for="nrperson" class="col-sm-3 col-form-label">Nr of persons</label>
              <div class="col-sm-9">
                <input type="number" min="1" class="form-control" id="nrperson"
                       [(ngModel)]="flat.numberOfPerson" name="numberOfPerson">
              </div>
            </div>
          </div>

          <button type="cancel" class="btn btn-danger btn-lg m-5 col-sm-2" routerLink="/meters/add">Add New Meter
          </button>

          <button type="submit" class="btn btn-success btn-lg m-5" (click)="saveFlat()">Submit</button>
          <button type="cancel" class="btn btn-danger btn-lg m-5" routerLink="/flats">Cancel</button>

        </div>
        <div *ngIf="submitted">
          <h4>Flat was submitted successfully!</h4>
          <button type="submit" class="btn btn-success btn-lg m-5 pt-5" (click)="newFlat()">Add new</button>
          <button type="cancel" class="btn btn-danger btn-lg m-5" routerLink="/flats">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</div>
<ng-template #loggedOut>
  Please login.
</ng-template>

